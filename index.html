<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <title>Chat ElevenLabs</title>
  <style>
    body{font-family:sans-serif;margin:2rem}
  </style>
</head>
<body>

<h1>Demo ElevenLabs ConvAI</h1>

<!-- Widget vazio: receberá o signed‑url via JS -->
<elevenlabs-convai id="chat" variant="expanded"></elevenlabs-convai>

<script>
window.addEventListener('DOMContentLoaded', async () => {
  try {
    // 1) busca seu signedUrl
    const res = await fetch('/.netlify/functions/signedUrl');
    if (!res.ok) throw new Error('signedUrl ' + res.status);
    const { signedUrl } = await res.json();

    // 2) seta no elemento
    const chatEl = document.getElementById('chat');
    chatEl.setAttribute('signed-url', signedUrl);

    // 3) injeta o script de embed _depois_ de já ter o signed-url
    const s = document.createElement('script');
    s.src = 'https://unpkg.com/@elevenlabs/convai-widget-embed';
    document.body.appendChild(s);

    console.log('ConvAI init OK');
  } catch (e) {
    console.error('Erro ao inicializar ConvAI:', e);
    alert('Falha ao inicializar o chat ElevenLabs');
  }
});
</script>
</script>

</body>
</html>
